<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt" xml:lang="pt"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>CAPESData - Pré-Processamento dos Dados da Plataforma Sucupira</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Resources/Images/favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Nenhum resultado",
    "search-matching-documents-text": "documentos correspondentes",
    "search-copy-link-title": "Copiar link para a busca",
    "search-hide-matches-text": "Esconder correspondências adicionais",
    "search-more-match-text": "mais correspondência neste documento",
    "search-more-matches-text": "mais correspondências neste documento",
    "search-clear-button-title": "Limpar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Procurar"
  }
}</script>


<link rel="stylesheet" href="styles.scss">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./sucupira-baixando.html">Dados do Coleta</a></li><li class="breadcrumb-item"><a href="./sucupira-preprocessamento.html">Pré-processamento</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./Resources/Images/logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Procurar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sobre</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Dados do Coleta</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sucupira-baixando.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Obtendo os dados</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sucupira-preprocessamento.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Pré-processamento</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sucupira-producao-eda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Análise Básica</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Dados Abertos</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dadosabertos-baixando.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Obtendo os dados</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dadosabertos-comparativo-idade-docentes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Idades dos Docentes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dadosabertos-comparativo-idade-discentes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Idades dos Discentes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dadosabertos-coautorias.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Coautorias</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./galeria.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Galeria</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Nesta página</h2>
   
  <ul>
  <li><a href="#sobre" id="toc-sobre" class="nav-link active" data-scroll-target="#sobre">Sobre</a>
  <ul class="collapse">
  <li><a href="#organização-das-planilhas" id="toc-organização-das-planilhas" class="nav-link" data-scroll-target="#organização-das-planilhas">Organização das Planilhas</a></li>
  <li><a href="#bibliotecas-usadas" id="toc-bibliotecas-usadas" class="nav-link" data-scroll-target="#bibliotecas-usadas">Bibliotecas usadas</a></li>
  </ul></li>
  <li><a href="#reorganizando-as-produções-intelectuais---contando-categorias-de-autores" id="toc-reorganizando-as-produções-intelectuais---contando-categorias-de-autores" class="nav-link" data-scroll-target="#reorganizando-as-produções-intelectuais---contando-categorias-de-autores">Reorganizando as Produções Intelectuais - Contando Categorias de Autores</a>
  <ul class="collapse">
  <li><a href="#complementando-com-dados-de-produções-do-ano-corrente" id="toc-complementando-com-dados-de-produções-do-ano-corrente" class="nav-link" data-scroll-target="#complementando-com-dados-de-produções-do-ano-corrente">Complementando com dados de produções do ano corrente</a></li>
  <li><a href="#unificando-as-bases-de-dados-de-produções-intelectuais" id="toc-unificando-as-bases-de-dados-de-produções-intelectuais" class="nav-link" data-scroll-target="#unificando-as-bases-de-dados-de-produções-intelectuais">Unificando as bases de dados de Produções Intelectuais</a></li>
  </ul></li>
  <li><a href="#reorganizando-as-produções-intelectuais---autores-como-lista" id="toc-reorganizando-as-produções-intelectuais---autores-como-lista" class="nav-link" data-scroll-target="#reorganizando-as-produções-intelectuais---autores-como-lista">Reorganizando as Produções Intelectuais - Autores como Lista</a>
  <ul class="collapse">
  <li><a href="#complementando-com-dados-de-produções-do-ano-corrente-1" id="toc-complementando-com-dados-de-produções-do-ano-corrente-1" class="nav-link" data-scroll-target="#complementando-com-dados-de-produções-do-ano-corrente-1">Complementando com dados de produções do ano corrente</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./sucupira-baixando.html">Dados do Coleta</a></li><li class="breadcrumb-item"><a href="./sucupira-preprocessamento.html">Pré-processamento</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Pré-Processamento dos Dados da Plataforma Sucupira</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="sobre" class="level2">
<h2 class="anchored" data-anchor-id="sobre">Sobre</h2>
<p>Os <a href="./sucupira-baixando.html">dados baixados da Plataforma Sucupira</a> estão na forma de planilhas do Excel, e podem contar informações redundantes e desnecessárias para as análises que queremos fazer, além de necessitarem de organização para facilitar o processamento. Neste documento veremos como transformar as planilhas em bases de dados que facilitarão as análises.</p>
<p>Dependendo da análise existem várias formas de preprocessar os dados. Vamos primeiro ver como os dados são organizados nas planilhas para entender melhor as alternativas.</p>
<section id="organização-das-planilhas" class="level3">
<h3 class="anchored" data-anchor-id="organização-das-planilhas">Organização das Planilhas</h3>
<p>As <a href="./sucupira-baixando.html">planilhas dos anos anteriores</a> contém todos os dados submetidos à Plataforma Sucupira, com uma planilha por ano, e com cada planilha representando categorias de dados submetidos à plataforma. Para os exemplos neste documento precisamos somente dos dados de produção científica, que estão armazenados em uma das abas da planilha. Uma cópia da tela da planilha (mostrando algumas de suas abas) e alguns registros sobre a de produção intelectual é mostrada abaixo.</p>
<p><a href="Resources/Images/Sucupira-planilha-completa-anos-anteriores.webp" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="Resources/Images/Sucupira-planilha-completa-anos-anteriores.webp" class="img-fluid"></a></p>
<p>Podemos ver que a produção intelectual não é representada na planilha por um conjunto de linhas e colunas uniforme – os dados de uma produção intelectual estão distribuídos em várias linhas, algumas com pares de campos (detalhamentos da produção) em uma coluna para o nome e uma para o valor do detalhamento; e os nomes e categorias dos autores em colunas separadas. A imagem abaixo mostra o detalhamento de uma <strong>única</strong> produção contida nesta planilha.</p>
<p><a href="Resources/Images/Sucupira-planilha-detalhe-anos-anteriores.webp" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="Resources/Images/Sucupira-planilha-detalhe-anos-anteriores.webp" class="img-fluid"></a></p>
<p>Para algumas das análises que queremos fazer precisamos ler as planilhas, filtrar todas as colunas desnecessárias e recuperar das múltiplas linhas por produção os dados que precisamos. O <a href="./sucupira-preprocessamento.html#reorganizando-as-produções-intelectuais---contando-categorias-de-autores">primeiro exemplo</a> mostra como criar registros de contagem de autores e categorias por publicações, e o <a href="./sucupira-preprocessamento.html#reorganizando-as-produções-intelectuais---autores-como-lista">segundo exemplo</a> mostra como criar registros de listas de autores por publicação.</p>
</section>
<section id="bibliotecas-usadas" class="level3">
<h3 class="anchored" data-anchor-id="bibliotecas-usadas">Bibliotecas usadas</h3>
<p>Usaremos Python para este preprocessamento. Primeiro importamos as bibliotecas necessárias:</p>
<div id="32873750" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> glob</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> Markdown</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="reorganizando-as-produções-intelectuais---contando-categorias-de-autores" class="level2">
<h2 class="anchored" data-anchor-id="reorganizando-as-produções-intelectuais---contando-categorias-de-autores">Reorganizando as Produções Intelectuais - Contando Categorias de Autores</h2>
<p>Queremos um conjunto de dados com uma publicação por registro e com contagem de autores por categorias. Para cada planilha vamos ler a aba <code>Produção Intelectual</code>, filtrar alguns campos que não são necessários e separar somente as linhas que tem nomes de autores. Como repetiremos estes passos para cada planilha é melhor definir uma função em Python que recebe o nome do arquivo e retorna um <em>dataframe</em> com os campos e linhas que precisamos:</p>
<div id="833418c4" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> preprocessaProducoesParaCategorias(fileName):</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Lemos a planilha.</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> warnings.catch_warnings():</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        warnings.filterwarnings(<span class="st">"ignore"</span>, category<span class="op">=</span><span class="pp">UserWarning</span>, </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                                module<span class="op">=</span>re.escape(<span class="st">'openpyxl.styles.stylesheet'</span>))</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_excel(fileName,engine<span class="op">=</span><span class="st">'openpyxl'</span>,sheet_name<span class="op">=</span><span class="st">'Produção Intelectual'</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Removemos os campos indesejados.    </span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    drop <span class="op">=</span> [<span class="st">'Calendário'</span>, <span class="st">'Ano do Calendário'</span>, </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Data-Hora do Envio'</span>,<span class="st">'Código do PPG'</span>,<span class="st">'Nome do PPG'</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Área de Avaliação'</span>,<span class="st">'IES Sigla'</span>,<span class="st">'IES Nome'</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Nome do Detalhamento'</span>,<span class="st">'Valor do Detalhamento'</span>,<span class="st">'Número de Ordem Autor'</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>             ]</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.drop(columns<span class="op">=</span>drop)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Removemos os campos onde 'Nome do Autor' estiver vazio.</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.dropna(subset<span class="op">=</span>[<span class="st">'Nome do Autor'</span>])</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A biblioteca usada para a leitura de planilhas gera advertências no código, para isto usamos filtros de alertas (veja mais detalhes <a href="https://stackoverflow.com/questions/66214951/deal-with-openpyxl-warning-workbook-contains-no-default-style-apply-openpyxl/77942784">aqui</a>).</p>
<p>Os dados que precisamos estão todos armazenados em planilhas, uma por ano, em um diretório (a lista de planilhas para este documento pode ser vista <a href="./sucupira-baixando.html#arquivos-baixados-neste-exemplo">aqui</a>):</p>
<div id="9237f56a" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="bu">dir</span> <span class="op">=</span> <span class="st">"Resources/Data/ColetaSucupira/"</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Podemos então criar uma lista de arquivos com nomes semelhantes no diretório indicado e uma lista de <em>dataframes</em> para receber os dados:</p>
<div id="27dd51a7" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>fileNames <span class="op">=</span> glob.glob(<span class="bu">dir</span><span class="op">+</span><span class="st">"relatorio_dados_enviados_coleta_20??.xlsx"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>dfs <span class="op">=</span> []</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Agora podemos ler cada um destes arquivos, filtrar linhas e colunas e anexar o <em>dataframe</em> filtrado à lista de <em>dataframes</em>:</p>
<div id="1266eca4" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> fileNames:</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> preprocessaProducoesParaCategorias(<span class="bu">file</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    dfs.append(df)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Em uma linha concatenaremos todos os <em>dataframes</em> da produção intelectual do conjunto de planilhas:</p>
<div id="e22c5ebb" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>dfconcatenado <span class="op">=</span> pd.concat(dfs, ignore_index<span class="op">=</span><span class="va">True</span>)    </span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Devemos manter somente as produções que <strong>não</strong> foram glosadas:</p>
<div id="dd4b9911" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>dfconcatenado <span class="op">=</span> dfconcatenado[dfconcatenado[<span class="st">'Produção Glosada?'</span>] <span class="op">==</span> <span class="st">'Não'</span>]</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>dfconcatenado.drop(columns<span class="op">=</span>[<span class="st">'Produção Glosada?'</span>], inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Agora temos todas as produções intelectuais de todos os anos que foram coletados na Plataforma Sucupira sobre nosso programa de pós-graduação. Mas estes dados ainda não estão prontos para a análise que queremos fazer: cada registro no <em>dataframe</em> contém informação sobre uma produção e um autor, portanto uma produção com quatro autores está representada em quatro registros.</p>
<p>Podemos entender melhor este <em>dataframe</em> temporário criando um subconjunto dele contendo somente registros do artigo <em>“A PLATFORM FOR LAND USE AND LAND COVER DATA INTEGRATION AND TRAJECTORY ANALYSIS”</em>. Vamos também remover algumas colunas da amostra para facilitar a visualização):</p>
<div id="bb84a9ab" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>dfamostra <span class="op">=</span> dfconcatenado.loc[dfconcatenado[<span class="st">'Título da Produção'</span>] <span class="op">==</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>           <span class="st">'A PLATFORM FOR LAND USE AND LAND COVER DATA INTEGRATION AND TRAJECTORY ANALYSIS'</span>]</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>dfamostra <span class="op">=</span> dfamostra.drop(columns<span class="op">=</span>[<span class="st">'Área de Concentração'</span>,<span class="st">'Linha de Pesquisa'</span>,<span class="st">'Projeto de Pesquisa'</span>])</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A amostra do <em>dataframe</em> pode ser visualizado com o código abaixo:</p>
<div id="6428117e" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>Markdown(dfamostra.to_markdown(index<span class="op">=</span><span class="va">False</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="9">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 9%">
<col style="width: 40%">
<col style="width: 10%">
<col style="width: 11%">
<col style="width: 17%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Ano da Produção</th>
<th style="text-align: left;">Título da Produção</th>
<th style="text-align: left;">Tipo da Produção</th>
<th style="text-align: left;">Subtipo da Produção</th>
<th style="text-align: left;">Nome do Autor</th>
<th style="text-align: left;">Categoria do Autor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: left;">A PLATFORM FOR LAND USE AND LAND COVER DATA INTEGRATION AND TRAJECTORY ANALYSIS</td>
<td style="text-align: left;">BIBLIOGRÁFICA</td>
<td style="text-align: left;">ARTIGO EM PERIÓDICO</td>
<td style="text-align: left;">FABIANA ZIOTI</td>
<td style="text-align: left;">Egresso - null</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: left;">A PLATFORM FOR LAND USE AND LAND COVER DATA INTEGRATION AND TRAJECTORY ANALYSIS</td>
<td style="text-align: left;">BIBLIOGRÁFICA</td>
<td style="text-align: left;">ARTIGO EM PERIÓDICO</td>
<td style="text-align: left;">KARINE REIS FERREIRA GOMES</td>
<td style="text-align: left;">Docente</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: left;">A PLATFORM FOR LAND USE AND LAND COVER DATA INTEGRATION AND TRAJECTORY ANALYSIS</td>
<td style="text-align: left;">BIBLIOGRÁFICA</td>
<td style="text-align: left;">ARTIGO EM PERIÓDICO</td>
<td style="text-align: left;">GILBERTO RIBEIRO DE QUEIROZ</td>
<td style="text-align: left;">Docente</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: left;">A PLATFORM FOR LAND USE AND LAND COVER DATA INTEGRATION AND TRAJECTORY ANALYSIS</td>
<td style="text-align: left;">BIBLIOGRÁFICA</td>
<td style="text-align: left;">ARTIGO EM PERIÓDICO</td>
<td style="text-align: left;">ALANA KASAHARA NEVES</td>
<td style="text-align: left;">Participante Externo</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: left;">A PLATFORM FOR LAND USE AND LAND COVER DATA INTEGRATION AND TRAJECTORY ANALYSIS</td>
<td style="text-align: left;">BIBLIOGRÁFICA</td>
<td style="text-align: left;">ARTIGO EM PERIÓDICO</td>
<td style="text-align: left;">FELIPE MENINO CARLOS</td>
<td style="text-align: left;">Discente - Mestrado</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: left;">A PLATFORM FOR LAND USE AND LAND COVER DATA INTEGRATION AND TRAJECTORY ANALYSIS</td>
<td style="text-align: left;">BIBLIOGRÁFICA</td>
<td style="text-align: left;">ARTIGO EM PERIÓDICO</td>
<td style="text-align: left;">FELIPE CARVALHO DE SOUZA</td>
<td style="text-align: left;">Egresso - null</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: left;">A PLATFORM FOR LAND USE AND LAND COVER DATA INTEGRATION AND TRAJECTORY ANALYSIS</td>
<td style="text-align: left;">BIBLIOGRÁFICA</td>
<td style="text-align: left;">ARTIGO EM PERIÓDICO</td>
<td style="text-align: left;">LORENA ALVES DOS SANTOS</td>
<td style="text-align: left;">Egresso - null</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: left;">A PLATFORM FOR LAND USE AND LAND COVER DATA INTEGRATION AND TRAJECTORY ANALYSIS</td>
<td style="text-align: left;">BIBLIOGRÁFICA</td>
<td style="text-align: left;">ARTIGO EM PERIÓDICO</td>
<td style="text-align: left;">ROLF EZEQUIEL DE OLIVEIRA SIMOES</td>
<td style="text-align: left;">Egresso - null</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>A tabela acima mostra que os valores dos campos <code>Título da Produção</code>, <code>Tipo da Produção</code> e <code>Subtipo da Produção</code> são os mesmos para a produção. Cada autor da produção aparece em um registro do <em>dataframe</em> com sua categoria. O que precisamos, para esta análise, é saber para cada produção quantos autores de cada categoria temos. Para isto precisamos do código a seguir:</p>
<div id="bd0ad7b9" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>dfProdAnter <span class="op">=</span> dfamostra.pivot_table(index<span class="op">=</span>[<span class="st">'Ano da Produção'</span>, <span class="st">'Título da Produção'</span>, </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">'Tipo da Produção'</span>, <span class="st">'Subtipo da Produção'</span>],</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                                           columns<span class="op">=</span><span class="st">'Categoria do Autor'</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                                           values<span class="op">=</span><span class="st">'Nome do Autor'</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                                           aggfunc<span class="op">=</span><span class="st">'count'</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                                           fill_value<span class="op">=</span><span class="dv">0</span>).reset_index()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>O código acima cria um novo <em>dataframe</em> a partir da amostra usando como identificador único das produção uma combinação dos campos <code>Ano da Produção</code>, <code>Título da Produção</code>, <code>Tipo da Produção</code> e <code>Subtipo da Produção</code>; criando novos campos com os valores presentes na coluna <code>Categoria do Autor</code> e contando os nomes em cada categoria para cada identificador único. Campos com contagem inexistente serão preenchidos com zeros.</p>
<p>Podemos visualizar o resultado na tabela abaixo.</p>
<div id="879e46e0" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>Markdown(dfProdAnter.to_markdown(index<span class="op">=</span><span class="va">False</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="11">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 8%">
<col style="width: 36%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Ano da Produção</th>
<th style="text-align: left;">Título da Produção</th>
<th style="text-align: left;">Tipo da Produção</th>
<th style="text-align: left;">Subtipo da Produção</th>
<th style="text-align: right;">Discente - Mestrado</th>
<th style="text-align: right;">Docente</th>
<th style="text-align: right;">Egresso - null</th>
<th style="text-align: right;">Participante Externo</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: left;">A PLATFORM FOR LAND USE AND LAND COVER DATA INTEGRATION AND TRAJECTORY ANALYSIS</td>
<td style="text-align: left;">BIBLIOGRÁFICA</td>
<td style="text-align: left;">ARTIGO EM PERIÓDICO</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Com o resultado comprovado podemos criar um <em>dataframe</em> que indica quantos autores por categoria para cada produção temos na base inteira.</p>
<div id="d8775327" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>dfProdAnter <span class="op">=</span> dfconcatenado.pivot_table(index<span class="op">=</span>[<span class="st">'Ano da Produção'</span>, <span class="st">'Título da Produção'</span>, </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>                                               <span class="st">'Tipo da Produção'</span>, <span class="st">'Subtipo da Produção'</span>],</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                                               columns<span class="op">=</span><span class="st">'Categoria do Autor'</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                                               values<span class="op">=</span><span class="st">'Nome do Autor'</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                                               aggfunc<span class="op">=</span><span class="st">'count'</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>                                               fill_value<span class="op">=</span><span class="dv">0</span>).reset_index()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vamos renomear o campo <code>Egresso - null</code>, criado pelos procedimentos anteriores a partir dos valores do campo <code>Categoria do Autor</code>.</p>
<div id="411e9974" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>dfProdAnter.rename(columns<span class="op">=</span>{<span class="st">'Egresso - null'</span>: <span class="st">'Egresso'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vamos também armazenar este <em>dataframe</em> em um arquivo para uso posterior.</p>
<div id="373aea28" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>dfProdAnter.to_csv(<span class="bu">dir</span><span class="op">+</span><span class="st">"CategoriaDeAutoresPorProdução-AnosAnteriores.csv"</span>,index<span class="op">=</span><span class="va">False</span>)                                     </span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vejamos os primeiros cinco registros deste novo <em>dataframe</em>:</p>
<div id="12f3a375" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>Markdown(dfProdAnter.head(<span class="dv">5</span>).to_markdown(index<span class="op">=</span><span class="va">False</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="15">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 6%">
<col style="width: 36%">
<col style="width: 6%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 8%">
<col style="width: 3%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Ano da Produção</th>
<th style="text-align: left;">Título da Produção</th>
<th style="text-align: left;">Tipo da Produção</th>
<th style="text-align: left;">Subtipo da Produção</th>
<th style="text-align: right;">Discente - Doutorado</th>
<th style="text-align: right;">Discente - Mestrado</th>
<th style="text-align: right;">Docente</th>
<th style="text-align: right;">Egresso</th>
<th style="text-align: right;">Participante Externo</th>
<th style="text-align: right;">Pós-Doc</th>
<th style="text-align: right;">Sem Categoria</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2014</td>
<td style="text-align: left;">‘MODELAGEM DE TURBULÊNCIA EM CAMADA LIMITE ATMOSFÉRICA / ATMOSPHERIC BOUNDARY LAYER TURBULENCE MODELLING’</td>
<td style="text-align: left;">TÉCNICA</td>
<td style="text-align: left;">APRESENTAÇÃO DE TRABALHO</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">2014</td>
<td style="text-align: left;">‘TURBULÊNCIA EM EVOLUÇÃO COSMOLÓGICA / TURBULENCE IN COSMOLOGICAL EVOLUTION’</td>
<td style="text-align: left;">TÉCNICA</td>
<td style="text-align: left;">APRESENTAÇÃO DE TRABALHO</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2014</td>
<td style="text-align: left;">8TH BRAZILIAN WORKSHOP ON SYSTEMATIC AND AUTOMATED SOFTWARE TESTING (SAST 2014)</td>
<td style="text-align: left;">TÉCNICA</td>
<td style="text-align: left;">ORGANIZAÇÃO DE EVENTO</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">2014</td>
<td style="text-align: left;">A CLUSTERING SEARCH METAHEURISTIC FOR THE POINT-FEATURE CARTOGRAPHIC LABEL PLACEMENT PROBLEM</td>
<td style="text-align: left;">BIBLIOGRÁFICA</td>
<td style="text-align: left;">ARTIGO EM PERIÓDICO</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2014</td>
<td style="text-align: left;">A CONSENSUS-BASED SEMI-SUPERVISED GROWING NEURAL GAS</td>
<td style="text-align: left;">BIBLIOGRÁFICA</td>
<td style="text-align: left;">TRABALHO EM ANAIS</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="complementando-com-dados-de-produções-do-ano-corrente" class="level3">
<h3 class="anchored" data-anchor-id="complementando-com-dados-de-produções-do-ano-corrente">Complementando com dados de produções do ano corrente</h3>
<p>A <a href="./sucupira-baixando.html#dados-do-preenchimento-do-ano-corrente">planilha com dados do ano corrente</a> (o que está em preenchimento na Plataforma Sucupira ou que foi enviada no ano) tem um formato ligeiramente diferente do das planilhas dos anos já preenchidos. A figura a seguir mostra uma cópia da tela da planilha do ano corrente (<em>no caso, 2023</em>), mostrando os registros da produção intelectual.</p>
<p><a href="Resources/Images/Sucupira-planilha-completa-ano-atual.webp" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="Resources/Images/Sucupira-planilha-completa-ano-atual.webp" class="img-fluid"></a></p>
<p>Nesta planilha uma produção intelectual também é representada por um conjunto de linhas e colunas, com nomes e categorias de coautores em linhas separadas. A imagem abaixo mostra o detalhamento de uma única produção contida nesta planilha.</p>
<p><a href="Resources/Images/Sucupira-planilha-detalhe-ano-atual.webp" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="Resources/Images/Sucupira-planilha-detalhe-ano-atual.webp" class="img-fluid"></a></p>
<p>Nesta seção iremos formatar estes dados de forma a deixá-los compatíveis com os que foram coletados nos anos passados.</p>
<p>Depois de <a href="./sucupira-baixando.html#dados-do-preenchimento-do-ano-corrente">baixar a planilha com dados do ano corrente</a> e renomeá-la adequadamente podemos usar o código abaixo para ler a única aba (<code>Produções - Autores</code>) em um <em>dataframe</em>.</p>
<div id="154183b0" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">"ListaReplicadaComAutores.xls"</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> warnings.catch_warnings():</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>     warnings.filterwarnings(<span class="st">"ignore"</span>, category<span class="op">=</span><span class="pp">UserWarning</span>, </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                             module<span class="op">=</span>re.escape(<span class="st">'openpyxl.styles.stylesheet'</span>))</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>     df <span class="op">=</span> pd.read_excel(<span class="bu">dir</span><span class="op">+</span>filename,engine<span class="op">=</span><span class="st">'openpyxl'</span>,sheet_name<span class="op">=</span><span class="st">'Produções - Autores'</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para eliminar as colunas do <em>dataframe</em> que não serão necessárias usamos o código a seguir:</p>
<div id="e7d15610" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>keep <span class="op">=</span> [<span class="st">'Ano da Produção'</span>,<span class="st">'Nome da Produção'</span>,<span class="st">'Tipo de Produção'</span>,</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Subtipo de Produção'</span>,<span class="st">'Nome do Autor'</span>,<span class="st">'Categoria do Autor'</span>]</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(columns<span class="op">=</span>[col <span class="cf">for</span> col <span class="kw">in</span> df.columns <span class="cf">if</span> col <span class="kw">not</span> <span class="kw">in</span> keep])</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Outro passo no processamento dos dados da planilha das produções do ano corrente é renomear algumas colunas para que fiquem compatíveis com as planilhas das produções dos anos anteriores.</p>
<div id="05a8e66b" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df.rename(columns<span class="op">=</span>{<span class="st">'Nome da Produção'</span>: <span class="st">'Título da Produção'</span>, </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'Tipo de Produção'</span>: <span class="st">'Tipo da Produção'</span>, </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'Subtipo de Produção'</span>: <span class="st">'Subtipo da Produção'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Podemos reorganizar o <em>dataframe</em> para conter somente uma publicação por linha e com a contagem de autores por categorias com o código abaixo:</p>
<div id="4461f9ea" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>dfProdAtual <span class="op">=</span> df.pivot_table(index<span class="op">=</span>[<span class="st">'Ano da Produção'</span>, <span class="st">'Título da Produção'</span>, </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">'Tipo da Produção'</span>, <span class="st">'Subtipo da Produção'</span>],</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                                    columns<span class="op">=</span><span class="st">'Categoria do Autor'</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                                    values<span class="op">=</span><span class="st">'Nome do Autor'</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                                    aggfunc<span class="op">=</span><span class="st">'count'</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>                                    fill_value<span class="op">=</span><span class="dv">0</span>).reset_index()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finalmente armazenamos este <em>dataframe</em> para uso posterior.</p>
<div id="ffcea367" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>dfProdAtual.to_csv(<span class="bu">dir</span><span class="op">+</span><span class="st">"CategoriaDeAutoresPorProdução-AnoCorrente.csv"</span>,index<span class="op">=</span><span class="va">False</span>)                                     </span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="unificando-as-bases-de-dados-de-produções-intelectuais" class="level3">
<h3 class="anchored" data-anchor-id="unificando-as-bases-de-dados-de-produções-intelectuais">Unificando as bases de dados de Produções Intelectuais</h3>
<p>Neste ponto temos duas bases de dados: <code>CategoriaDeAutoresPorProdução-AnosAnteriores.csv</code> e <code>CategoriaDeAutoresPorProdução-AnoCorrente.csv</code>. Embora as duas representem basicamente as mesmas informações, o formato é ligeiramente diferente na ordem das colunas e nos campos, que podem ser diferentes dependendo das categorias de coautores presentes nas planilhas originais. O código nesta seção ajusta e unifica os dados.</p>
<p>A planilha com os dados de anos anteriores diferencia entre coautores de categorias <code>Discente - Mestrado</code> e <code>Discente - Doutorado</code>, mas a do ano atual não. Devemos então unificar as colunas <code>Discente - Mestrado</code> e <code>Discente - Doutorado</code> do <em>dataframe</em> contendo a produção intelectual dos anos anteriores, armazenando a soma na coluna nova <code>Discente</code>.</p>
<div id="18bdf050" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>dfProdAnter <span class="op">=</span> dfProdAnter.assign(Discente<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="st">'Discente - Doutorado'</span>] <span class="op">+</span> x[<span class="st">'Discente - Mestrado'</span>])</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>dfProdAnter <span class="op">=</span> dfProdAnter.drop(columns<span class="op">=</span>[<span class="st">'Discente - Doutorado'</span>, <span class="st">'Discente - Mestrado'</span>])</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Com isto posso unificar os <em>dataframes</em> contendo a produção intelectual dos anos anteriores e a do ano atual. O <em>dataframe</em> resultante receberá todas as linhas e colunas dos <em>dataframes</em> unificados, e onde um campo não tiver correspondência preencheremos o seu valor com zero:</p>
<div id="edcf7d07" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>comuns <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(dfProdAnter.columns) <span class="op">&amp;</span> <span class="bu">set</span>(dfProdAtual.columns))</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>dfProdUnificada <span class="op">=</span> pd.merge(dfProdAnter, dfProdAtual, on<span class="op">=</span>comuns, how<span class="op">=</span><span class="st">'outer'</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>dfProdUnificada.fillna(<span class="dv">0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Salvamos também este <em>dataframe</em> para uso posterior.</p>
<div id="d06ef511" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>dfProdUnificada.to_csv(<span class="bu">dir</span><span class="op">+</span><span class="st">"CategoriaDeAutoresPorProdução-Unificada.csv"</span>,index<span class="op">=</span><span class="va">False</span>)                                     </span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="reorganizando-as-produções-intelectuais---autores-como-lista" class="level2">
<h2 class="anchored" data-anchor-id="reorganizando-as-produções-intelectuais---autores-como-lista">Reorganizando as Produções Intelectuais - Autores como Lista</h2>
<p>Queremos também obter um conjunto de dados com uma publicação por registro e com os nomes e categorias de autores representados como uma lista formatada como uma string. Para cada planilha vamos ler a aba Produção Intelectual e tratar as múltiplas linhas que contém informações sobre os autores e publicação para criar a nova estrutura.</p>
<p>Vamos também usar uma função em Python para fazer isto:</p>
<div id="26559cab" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> preprocessaProducoesParaAutores(fileName):</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Lemos a planilha</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> warnings.catch_warnings():</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>        warnings.filterwarnings(<span class="st">"ignore"</span>, category<span class="op">=</span><span class="pp">UserWarning</span>, </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>                                module<span class="op">=</span>re.escape(<span class="st">'openpyxl.styles.stylesheet'</span>))</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_excel(fileName,engine<span class="op">=</span><span class="st">'openpyxl'</span>,sheet_name<span class="op">=</span><span class="st">'Produção Intelectual'</span>)    </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Criamos um dicionário para armazenar os dados estruturados. </span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    publicacoes <span class="op">=</span> {}</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Lemos cada linha da planilha para mapear para o dicionário.</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _, row <span class="kw">in</span> df.iterrows():</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>        titulo <span class="op">=</span> row[<span class="st">"Título da Produção"</span>]</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> pd.notna(titulo):</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Se é a primeira vez que vemos esta publicação...</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> titulo <span class="kw">not</span> <span class="kw">in</span> publicacoes:</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>                publicacoes[titulo] <span class="op">=</span> {</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Ano da Produção"</span>: row[<span class="st">"Ano do Calendário"</span>],</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Título da Produção"</span>: titulo, </span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Glosada"</span>: <span class="st">"Não"</span>, </span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"ISSN"</span>: <span class="st">""</span>,</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Título do Periódico"</span>: <span class="st">""</span>,                    </span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"DOI"</span>: <span class="st">""</span>,</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"URL"</span>: <span class="st">""</span>,</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Tipo"</span>: row[<span class="st">"Tipo da Produção"</span>],</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Subtipo"</span>: row[<span class="st">"Subtipo da Produção"</span>],</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Idioma"</span>: <span class="st">""</span>,</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Autores"</span>: [],</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Categorias"</span>: []</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Atualiza metadados da publicação</span></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> row[<span class="st">"Nome do Detalhamento"</span>] <span class="op">==</span> <span class="st">"ISSN / Título do periódico"</span>:</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>            valores <span class="op">=</span> row[<span class="st">"Valor do Detalhamento"</span>].split(<span class="st">"/"</span>)</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>            publicacoes[titulo][<span class="st">"ISSN"</span>] <span class="op">=</span> valores[<span class="dv">0</span>].strip() <span class="cf">if</span> <span class="bu">len</span>(valores) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">""</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>            publicacoes[titulo][<span class="st">"Título do Periódico"</span>] <span class="op">=</span> valores[<span class="dv">1</span>].strip() <span class="cf">if</span> <span class="bu">len</span>(valores) <span class="op">&gt;</span> <span class="dv">1</span> <span class="cf">else</span> <span class="st">""</span></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> row[<span class="st">"Nome do Detalhamento"</span>] <span class="op">==</span> <span class="st">"Idioma"</span>:</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>            publicacoes[titulo][<span class="st">"Idioma"</span>] <span class="op">=</span> row[<span class="st">"Valor do Detalhamento"</span>].strip()</span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> row[<span class="st">"Nome do Detalhamento"</span>] <span class="op">==</span> <span class="st">"Número do DOI"</span>:</span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>            publicacoes[titulo][<span class="st">"DOI"</span>] <span class="op">=</span> row[<span class="st">"Valor do Detalhamento"</span>].strip()            </span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> row[<span class="st">"Nome do Detalhamento"</span>] <span class="op">==</span> <span class="st">"URL"</span>:</span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>            publicacoes[titulo][<span class="st">"URL"</span>] <span class="op">=</span> row[<span class="st">"Valor do Detalhamento"</span>].strip()            </span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Verificamos se há alguma indicação de glosa</span></span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"glosa"</span> <span class="kw">in</span> <span class="bu">str</span>(row.to_dict()).lower():</span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a>            publicacoes[titulo][<span class="st">"Glosada"</span>] <span class="op">=</span> <span class="st">"Sim"</span></span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Se a linha contiver um autor, adiciona à lista da publicação correta</span></span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> pd.notna(row[<span class="st">"Nome do Autor"</span>]):</span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a>            publicacoes[titulo][<span class="st">"Autores"</span>].append(row[<span class="st">"Nome do Autor"</span>].strip())</span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a>            publicacoes[titulo][<span class="st">"Categorias"</span>].append(row[<span class="st">"Categoria do Autor"</span>].strip())</span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convertemos listas de autores e categorias para strings</span></span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> titulo <span class="kw">in</span> publicacoes:</span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true" tabindex="-1"></a>        publicacoes[titulo][<span class="st">"Autores"</span>] <span class="op">=</span> <span class="st">" ; "</span>.join(publicacoes[titulo][<span class="st">"Autores"</span>])</span>
<span id="cb24-59"><a href="#cb24-59" aria-hidden="true" tabindex="-1"></a>        publicacoes[titulo][<span class="st">"Categorias"</span>] <span class="op">=</span> <span class="st">" ; "</span>.join(publicacoes[titulo][<span class="st">"Categorias"</span>])</span>
<span id="cb24-60"><a href="#cb24-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-61"><a href="#cb24-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convertemos o dicionário para dataframe</span></span>
<span id="cb24-62"><a href="#cb24-62" aria-hidden="true" tabindex="-1"></a>    df_final <span class="op">=</span> pd.DataFrame(publicacoes.values())</span>
<span id="cb24-63"><a href="#cb24-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df_final</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Algumas definições usadas no <a href="./sucupira-preprocessamento.html#reorganizando-as-produções-intelectuais---contando-categorias-de-autores">primeiro exemplo</a> são repetidas aqui para maior clareza.</p>
<p>Primeiro criamos a lista de arquivos a serem lidos e uma lista de <em>dataframes</em> para receber os dados:</p>
<div id="76f5efa1" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="bu">dir</span> <span class="op">=</span> <span class="st">"Resources/Data/ColetaSucupira/"</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>fileNames <span class="op">=</span> glob.glob(<span class="bu">dir</span><span class="op">+</span><span class="st">"relatorio_dados_enviados_coleta_20??.xlsx"</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>dfs <span class="op">=</span> []</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Lemos cada um destes arquivos pela função que preprocessa e criamos um <em>dataframe</em> com uma linha para cada publicação:</p>
<div id="00f4b3d1" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> fileNames:</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> preprocessaProducoesParaAutores(<span class="bu">file</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    dfs.append(df)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Concatenamos todos os <em>dataframes</em> criados:</p>
<div id="78451b90" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>dfconcatenado <span class="op">=</span> pd.concat(dfs, ignore_index<span class="op">=</span><span class="va">True</span>)  </span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para verificar o <em>dataframe</em> vamos criar uma amostra contendo somente registros do artigo <em>“A PLATFORM FOR LAND USE AND LAND COVER DATA INTEGRATION AND TRAJECTORY ANALYSIS”</em>.</p>
<div id="6c2c05a1" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>dfamostra <span class="op">=</span> dfconcatenado.loc[dfconcatenado[<span class="st">'Título da Produção'</span>] <span class="op">==</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>           <span class="st">'A PLATFORM FOR LAND USE AND LAND COVER DATA INTEGRATION AND TRAJECTORY ANALYSIS'</span>]</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A visualização deve mostrar a estrutura esperada (uma publicação por linha; autores e categorias concatenados):</p>
<div id="67289129" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>Markdown(dfamostra.to_markdown(index<span class="op">=</span><span class="va">False</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="29">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 3%">
<col style="width: 12%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 13%">
<col style="width: 1%">
<col style="width: 5%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 1%">
<col style="width: 32%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Ano da Produção</th>
<th style="text-align: left;">Título da Produção</th>
<th style="text-align: left;">Glosada</th>
<th style="text-align: left;">ISSN</th>
<th style="text-align: left;">Título do Periódico</th>
<th style="text-align: left;">DOI</th>
<th style="text-align: left;">URL</th>
<th style="text-align: left;">Tipo</th>
<th style="text-align: left;">Subtipo</th>
<th style="text-align: left;">Idioma</th>
<th style="text-align: left;">Autores</th>
<th style="text-align: left;">Categorias</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: left;">A PLATFORM FOR LAND USE AND LAND COVER DATA INTEGRATION AND TRAJECTORY ANALYSIS</td>
<td style="text-align: left;">Sim</td>
<td style="text-align: left;">1569-8432</td>
<td style="text-align: left;">(1569-8432) INTERNATIONAL JOURNAL OF APPLIED EARTH OBSERVATION AND GEOINFORMATION</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">[doi:10.1016/j.jag.2021.102655]</td>
<td style="text-align: left;">BIBLIOGRÁFICA</td>
<td style="text-align: left;">ARTIGO EM PERIÓDICO</td>
<td style="text-align: left;">INGLES</td>
<td style="text-align: left;">FABIANA ZIOTI ; KARINE REIS FERREIRA GOMES ; GILBERTO RIBEIRO DE QUEIROZ ; ALANA KASAHARA NEVES ; FELIPE MENINO CARLOS ; FELIPE CARVALHO DE SOUZA ; LORENA ALVES DOS SANTOS ; ROLF EZEQUIEL DE OLIVEIRA SIMOES</td>
<td style="text-align: left;">Egresso - null ; Docente ; Docente ; Participante Externo ; Discente - Mestrado ; Egresso - null ; Egresso - null ; Egresso - null</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="complementando-com-dados-de-produções-do-ano-corrente-1" class="level3">
<h3 class="anchored" data-anchor-id="complementando-com-dados-de-produções-do-ano-corrente-1">Complementando com dados de produções do ano corrente</h3>
<p>A <a href="./sucupira-baixando.html#dados-do-preenchimento-do-ano-corrente">planilha com dados do ano corrente</a> (o que está em preenchimento na Plataforma Sucupira ou que foi enviada no ano) tem um formato ligeiramente diferente do das planilhas dos anos já preenchidos. Comparando com as planilhas de anos passados, veremos que muitos campos não tem correspondência (por exemplo, <code>Glosada</code>, <code>ISSN</code>, <code>DOI</code>, <code>URL</code>, <code>Idioma</code>). Mesmo assim tentaremos ler esta planilha, com os dados que forem compatíveis com as dos anos anteriores.</p>
<p>Vamos criar uma função semelhante a <code>preprocessaProducoesParaAutores</code> para ler a planilha do ano atual. Esta função vai criar campos vazios, mas compatíveis com o <em>dataframe</em> retornado pela função <code>preprocessaProducoesParaAutores</code>:</p>
<div id="96ab7c51" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> preprocessaProducoesParaAutores_Atual(file_path):</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Carregar planilha</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_excel(file_path, sheet_name<span class="op">=</span><span class="st">"Produções - Autores"</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Criar dicionário para armazenar os dados estruturados</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    producoes <span class="op">=</span> {}</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _, row <span class="kw">in</span> df.iterrows():</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>        titulo <span class="op">=</span> row[<span class="st">"Nome da Produção"</span>]</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> pd.notna(titulo):</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Criar nova entrada se for um título novo</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> titulo <span class="kw">not</span> <span class="kw">in</span> producoes:</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>                producoes[titulo] <span class="op">=</span> {</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Ano da Produção"</span>: row[<span class="st">"Ano da Produção"</span>],</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Título da Produção"</span>: titulo, </span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Glosada"</span>: <span class="st">""</span>, </span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"ISSN"</span>: <span class="st">""</span>,</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Título do Periódico"</span>: <span class="st">""</span>,                    </span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"DOI"</span>: <span class="st">""</span>,</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"URL"</span>: <span class="st">""</span>,</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Tipo"</span>: row[<span class="st">"Tipo de Produção"</span>],</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Subtipo"</span>: row[<span class="st">"Subtipo de Produção"</span>],</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Idioma"</span>: <span class="st">""</span>,</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Autores"</span>: [],</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Categorias"</span>: []</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Se a linha contiver um autor, adiciona à lista da produção correta</span></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> pd.notna(row[<span class="st">"Nome do Autor"</span>]):</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>            producoes[titulo][<span class="st">"Autores"</span>].append(row[<span class="st">"Nome do Autor"</span>].strip())</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>            producoes[titulo][<span class="st">"Categorias"</span>].append(row[<span class="st">"Categoria do Autor"</span>].strip())</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Converter listas de autores e categorias para strings</span></span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> titulo <span class="kw">in</span> producoes:</span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>        producoes[titulo][<span class="st">"Autores"</span>] <span class="op">=</span> <span class="st">"; "</span>.join(producoes[titulo][<span class="st">"Autores"</span>])</span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>        producoes[titulo][<span class="st">"Categorias"</span>] <span class="op">=</span> <span class="st">"; "</span>.join(producoes[titulo][<span class="st">"Categorias"</span>])</span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Converter para DataFrame</span></span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>    df_final <span class="op">=</span> pd.DataFrame(producoes.values())</span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df_final</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Com esta função podemos ler a planilha com os dados do ano atual:</p>
<div id="59d47a54" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>dfAtual <span class="op">=</span> preprocessaProducoesParaAutores_Atual(<span class="st">"Resources/Data/ColetaSucupira/ListaReplicadaComAutores.xls"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/rafael/anaconda3/lib/python3.11/site-packages/openpyxl/styles/stylesheet.py:237: UserWarning:

Workbook contains no default style, apply openpyxl's default
</code></pre>
</div>
</div>
<p>Unimos este novo <em>dataframe</em> ao já criado com as planilhas dos anos anteriores:</p>
<div id="356330a8" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>dfUnificado <span class="op">=</span> pd.concat([dfconcatenado, dfAtual], ignore_index<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Salvamos em um arquivo local para uso posterior:</p>
<div id="1d97bec1" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>dfUnificado.to_csv(<span class="bu">dir</span><span class="op">+</span><span class="st">"ProduçãoComListaDeAutores.csv"</span>,index<span class="op">=</span><span class="va">False</span>)  </span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiada");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiada");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p><a href="https://linktr.ee/rafaeldcsantos">Rafael Santos</a></p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"selector":".lightbox","closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom"});
window.onload = () => {
  lightboxQuarto.on('slide_before_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    const href = trigger.getAttribute('href');
    if (href !== null) {
      const imgEl = window.document.querySelector(`a[href="${href}"] img`);
      if (imgEl !== null) {
        const srcAttr = imgEl.getAttribute("src");
        if (srcAttr && srcAttr.startsWith("data:")) {
          slideConfig.href = srcAttr;
        }
      }
    } 
  });

  lightboxQuarto.on('slide_after_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    if (window.Quarto?.typesetMath) {
      window.Quarto.typesetMath(slideNode);
    }
  });

};
          </script>




</body></html>